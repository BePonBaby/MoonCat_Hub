-- MoonCat Hub (Kavo UI - Trong suốt, Ngầu, Xịn, Có BlurEffect, Viền LED Neon)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local SoundService = game:GetService("SoundService")

-- Tải thư viện Kavo UI
local success, Library = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
end)

if not success then
    warn("Không thể tải Kavo UI: " .. tostring(Library))
    return
end

-- Tạo BlurEffect
local Blur = Instance.new("BlurEffect")
Blur.Size = 10
Blur.Parent = Lighting

-- Tạo giao diện Kavo UI
local Window = Library.CreateLib("MoonCat Hub - Blox Fruits", "DarkTheme")

-- Tùy chỉnh giao diện
Window.BackgroundTransparency = 0.3
Window.BlurEffect = true
Window.TitleColor = Color3.fromRGB(255, 105, 180)
Window.TabColor = Color3.fromRGB(75, 0, 130)
Window.ButtonColor = Color3.fromRGB(0, 191, 255)
Window.ToggleColor = Color3.fromRGB(255, 215, 0)

-- Tạo viền LED neon (UIStroke không áp dụng trực tiếp cho Kavo UI, nhưng có thể áp dụng cho các Frame bên trong nếu cần)
-- Kavo UI không hỗ trợ UIStroke trực tiếp, nên ta sẽ tập trung vào hiệu ứng Blur và màu sắc

-- Biến trạng thái
local toggles = {
    AutoFarmLevel = false,
    AutoQuest = false,
    AutoRaid = false,
    AutoSeaEvent = false,
    AutoFruitSniper = false,
    FastAttack = false,
    Aimbot = false,
    AutoTushita = false,
    AutoYama = false,
    AutoSharkAnchor = false,
    AutoGuitar = false,
    AutoDragonBelt = false,
    ESP = false,
}
local attackSpeed = 0.5
local espInstances = {}

-- Tạo âm thanh khi nhấn nút
local clickSound = Instance.new("Sound")
clickSound.SoundId = "rbxassetid://182765513"
clickSound.Volume = 0.5
clickSound.Parent = SoundService

-- Hàm phát âm thanh
local function playClickSound()
    clickSound:Play()
end

-- Hàm dịch chuyển
local function teleportTo(pos)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = pos
    end
end

-- Hàm kiểm tra Full Moon
local function isFullMoon()
    local timeOfDay = Lighting.ClockTime
    return timeOfDay >= 18 and timeOfDay <= 20 and Lighting.Brightness >= 0.5
end

-- Hàm dọn dẹp ESP
local function clearESP()
    for _, esp in pairs(espInstances) do
        if esp then
            esp:Destroy()
        end
    end
    espInstances = {}
end

-- 1️⃣ Tab Auto Farm & Quest
local FarmTab = Window:NewTab("Farm & Quest")
local FarmSection = FarmTab:NewSection("Farm Features")
FarmSection:NewToggle("Auto Farm Level", "Tự động đánh quái", function(state)
    toggles.AutoFarmLevel = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoFarmLevel and LocalPlayer.Character do
                if next(Workspace.Enemies:GetChildren()) then
                    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                            teleportTo(enemy.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0))
                            wait(attackSpeed)
                        end
                    end
                else
                    Library:Notify("Không tìm thấy quái để farm!", 3)
                    wait(2)
                end
                wait(1)
            end
        end)
    end
end)

FarmSection:NewToggle("Auto Quest", "Tự động làm nhiệm vụ", function(state)
    toggles.AutoQuest = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoQuest and LocalPlayer.Character do
                ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", "BartiloQuest1", 1)
                if next(Workspace.Enemies:GetChildren()) then
                    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                            teleportTo(enemy.HumanoidRootPart.CFrame)
                            wait(attackSpeed)
                        end
                    end
                end
                wait(2)
            end
        end)
    end
end)

-- 2️⃣ Tab Auto Raid & Sea Event
local RaidTab = Window:NewTab("Raid & Sea Event")
local RaidSection = RaidTab:NewSection("Raid & Event Features")
RaidSection:NewToggle("Auto Raid", "Tự động tham gia Raid", function(state)
    toggles.AutoRaid = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoRaid and LocalPlayer.Character do
                ReplicatedStorage.Remotes.CommF_:InvokeServer("Raids", "StartRaid")
                teleportTo(CFrame.new(0, 1000, 0))
                wait(5)
            end
        end)
    end
end)

RaidSection:NewToggle("Auto Sea Event", "Tự động săn Sea Beast", function(state)
    toggles.AutoSeaEvent = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoSeaEvent and LocalPlayer.Character do
                if next(Workspace.SeaBeasts:GetChildren()) then
                    for _, seaBeast in pairs(Workspace.SeaBeasts:GetChildren()) do
                        if seaBeast:FindFirstChild("Humanoid") and seaBeast.Humanoid.Health > 0 then
                            teleportTo(seaBeast.HumanoidRootPart.CFrame)
                            wait(attackSpeed)
                        end
                    end
                end
                wait(2)
            end
        end)
    end
end)

-- 3️⃣ Tab Fruit Sniper
local FruitTab = Window:NewTab("Fruit Sniper")
local FruitSection = FruitTab:NewSection("Fruit Features")
FruitSection:NewToggle("Auto Fruit Sniper", "Tự động nhặt trái ác quỷ", function(state)
    toggles.AutoFruitSniper = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoFruitSniper and LocalPlayer.Character do
                for _, fruit in pairs(Workspace:GetChildren()) do
                    if fruit:IsA("Tool") and fruit:FindFirstChild("Handle") and fruit.Name:match("Fruit") then
                        teleportTo(fruit.Handle.CFrame)
                        wait(0.5)
                    end
                end
                wait(1)
            end
        end)
    end
end)

-- 4️⃣ Tab Combat
local CombatTab = Window:NewTab("Combat")
local CombatSection = CombatTab:NewSection("Combat Features")
CombatSection:NewToggle("Fast Attack", "Tăng tốc độ tấn công", function(state)
    toggles.FastAttack = state
    playClickSound()
    attackSpeed = state and 0.2 or 0.5
end)

CombatSection:NewToggle("Aimbot", "Ngắm bắn tự động", function(state)
    toggles.Aimbot = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.Aimbot and LocalPlayer.Character do
                for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                    if enemy:FindFirstChild("HumanoidRootPart") then
                        local distance = (enemy.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                        if distance < 50 then
                            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(LocalPlayer.Character.HumanoidRootPart.Position, enemy.HumanoidRootPart.Position)
                        end
                        wait(0.2)
                    end
                end
                wait(0.5)
            end
        end)
    end
end)

-- 5️⃣ Tab Teleport
local TeleportTab = Window:NewTab("Teleport")
local TeleportSection = TeleportTab:NewSection("Teleport Features")
TeleportSection:NewDropdown("Teleport to Island", "Dịch chuyển đến đảo", {
    "Starter Pirate Island", "Starter Marine Island", "Jungle", "Pirate Village", "Desert",
    "Middle Island", "Frozen Village", "Marine Fortress", "Skylands", "Prison",
    "Colosseum", "Magma Village", "Underwater City", "Fountain City",
    "Kingdom of Rose", "Usoap’s Island", "Graveyard Island", "Dark Arena", "Snow Mountain",
    "Hot and Cold", "Cursed Ship", "Ice Castle", "Forgotten Island",
    "Port Town", "Hydra Island", "Great Tree", "Floating Turtle", "Castle on the Sea",
    "Haunted Castle", "Sea of Treats", "Tiki Outpost", "Heaven Dimension", "Hell Dimension",
    "Frozen Dimension", "Treasure Island", "Mirage Island"
}, function(selected)
    playClickSound()
    local locations = {
        ["Starter Pirate Island"] = CFrame.new(1050, 17, 1350),
        ["Starter Marine Island"] = CFrame.new(-500, 17, 1500),
        ["Jungle"] = CFrame.new(1500, 17, -1500),
        ["Pirate Village"] = CFrame.new(100, 17, -5000),
        ["Desert"] = CFrame.new(1000, 17, 4500),
        ["Middle Island"] = CFrame.new(0, 17, 0),
        ["Frozen Village"] = CFrame.new(1200, 17, -1100),
        ["Marine Fortress"] = CFrame.new(-5000, 17, 5000),
        ["Skylands"] = CFrame.new(150, 500, 150),
        ["Prison"] = CFrame.new(5000, 17, 1000),
        ["Colosseum"] = CFrame.new(-1500, 17, 3000),
        ["Magma Village"] = CFrame.new(-5000, 17, -2000),
        ["Underwater City"] = CFrame.new(4000, -200, 4000),
        ["Fountain City"] = CFrame.new(5000, 17, -5000),
        ["Kingdom of Rose"] = CFrame.new(-2000, 17, -2000),
        ["Usoap’s Island"] = CFrame.new(-3000, 17, 1000),
        ["Graveyard Island"] = CFrame.new(500, 17, 3000),
        ["Dark Arena"] = CFrame.new(5000, 17, 5000),
        ["Snow Mountain"] = CFrame.new(1000, 500, -3000),
        ["Hot and Cold"] = CFrame.new(-5000, 17, 3000),
        ["Cursed Ship"] = CFrame.new(0, 500, 5000),
        ["Ice Castle"] = CFrame.new(5000, 17, -3000),
        ["Forgotten Island"] = CFrame.new(-3000, 17, -5000),
        ["Port Town"] = CFrame.new(-300, 17, -1000),
        ["Hydra Island"] = CFrame.new(5750, 610, -280),
        ["Great Tree"] = CFrame.new(2000, 17, -5000),
        ["Floating Turtle"] = CFrame.new(-12550, 332, -7870),
        ["Castle on the Sea"] = CFrame.new(-5000, 17, 1000),
        ["Haunted Castle"] = CFrame.new(-9500, 17, 5000),
        ["Sea of Treats"] = CFrame.new(0, 17, -10000),
        ["Tiki Outpost"] = CFrame.new(-16250, 100, 1000),
        ["Heaven Dimension"] = CFrame.new(0, 1000, 0),
        ["Hell Dimension"] = CFrame.new(0, -1000, 0),
        ["Frozen Dimension"] = CFrame.new(5000, 17, 5000),
        ["Treasure Island"] = CFrame.new(-10000, 17, -5000),
        ["Mirage Island"] = CFrame.new(0, 100, 0)
    }
    teleportTo(locations[selected])
end)

-- 6️⃣ Tab Auto Weapons
local WeaponTab = Window:NewTab("Weapons")
local WeaponSection = WeaponTab:NewSection("Weapon Features")
WeaponSection:NewToggle("Auto Tushita", "Tự động lấy Tushita", function(state)
    toggles.AutoTushita = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoTushita and LocalPlayer.Character do
                teleportTo(CFrame.new(-12550, 332, -7870))
                if next(Workspace.Enemies:GetChildren()) then
                    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                            teleportTo(enemy.HumanoidRootPart.CFrame)
                            wait(attackSpeed)
                        end
                    end
                end
                teleportTo(CFrame.new(5750, 610, -280))
                wait(1)
                teleportTo(CFrame.new(-10200, 996, -6870))
                if next(Workspace.Enemies:GetChildren()) then
                    for _, boss in pairs(Workspace.Enemies:GetChildren()) do
                        if boss.Name == "rip_indra True Form" and boss:FindFirstChild("Humanoid") and boss.Humanoid.Health > 0 then
                            teleportTo(boss.HumanoidRootPart.CFrame)
                            wait(attackSpeed)
                        end
                    end
                end
                ReplicatedStorage.Remotes.CommF_:InvokeServer("YamaQuest", "BuyTushita")
                wait(5)
            end
        end)
    end
end)

WeaponSection:NewToggle("Auto Yama", "Tự động lấy Yama", function(state)
    toggles.AutoYama = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoYama and LocalPlayer.Character do
                teleportTo(CFrame.new(-12550, 332, -7870))
                local eliteCount = 0
                while eliteCount < 30 and toggles.AutoYama do
                    if next(Workspace.Enemies:GetChildren()) then
                        for _, elite in pairs(Workspace.Enemies:GetChildren()) do
                            if elite.Name == "Elite Pirate" and elite:FindFirstChild("Humanoid") and elite.Humanoid.Health > 0 then
                                teleportTo(elite.HumanoidRootPart.CFrame)
                                wait(attackSpeed)
                                eliteCount = eliteCount + 1
                            end
                        end
                    end
                    wait(1)
                end
                teleportTo(CFrame.new(5230, 602, -280))
                ReplicatedStorage.Remotes.CommF_:InvokeServer("EliteHunter", "PullYama")
                wait(1)
                ReplicatedStorage.Remotes.CommF_:InvokeServer("YamaQuest", "BuyYama")
                wait(5)
            end
        end)
    end
end)

WeaponSection:NewToggle("Auto Shark Anchor", "Tự động lấy Shark Anchor", function(state)
    toggles.AutoSharkAnchor = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoSharkAnchor and LocalPlayer.Character do
                teleportTo(CFrame.new(-16250, 100, 1000))
                if next(Workspace.SeaBeasts:GetChildren()) then
                    for _, seaBeast in pairs(Workspace.SeaBeasts:GetChildren()) do
                        if seaBeast.Name == "Terror Shark" and seaBeast:FindFirstChild("Humanoid") and seaBeast.Humanoid.Health > 0 then
                            teleportTo(seaBeast.HumanoidRootPart.CFrame)
                            wait(attackSpeed)
                        end
                    end
                end
                teleportTo(CFrame.new(-16550, 55, 2300))
                ReplicatedStorage.Remotes.CommF_:InvokeServer("BuyItem", "Shark Anchor")
                wait(5)
            end
        end)
    end
end)

WeaponSection:NewToggle("Auto Guitar", "Tự động lấy Guitar", function(state)
    toggles.AutoGuitar = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoGuitar and LocalPlayer.Character do
                if game.PlaceId == 7449423635 and isFullMoon() then
                    for _, island in pairs(Workspace:GetChildren()) do
                        if island.Name == "Mirage Island" then
                            if island:FindFirstChild("HighestPoint") then
                                teleportTo(island.HighestPoint.CFrame)
                                for _, part in pairs(island:GetChildren()) do
                                    if part.Name == "HighestPoint" and part:FindFirstChild("ClickDetector") then
                                        fireclickdetector(part.ClickDetector)
                                    end
                                end
                            end
                            for _, gear in pairs(island:GetChildren()) do
                                if gear.Name == "Blue Gear" then
                                    teleportTo(gear.CFrame)
                                    if gear:FindFirstChild("ClickDetector") then
                                        fireclickdetector(gear.ClickDetector)
                                    end
                                    break
                                end
                            end
                            teleportTo(CFrame.new(-5075, 315, -3150))
                            ReplicatedStorage.Remotes.CommF_:InvokeServer("Awakener", "PullLever")
                            ReplicatedStorage.Remotes.CommF_:InvokeServer("BuyItem", "Electric Guitar")
                            wait(5)
                            break
                        end
                    end
                    Library:Notify("Không tìm thấy Mirage Island, đang tìm lại...", 3)
                else
                    Library:Notify("Cần Full Moon và ở Sea 3 để lấy Guitar!", 3)
                end
                wait(10)
            end
        end)
    end
end)

WeaponSection:NewToggle("Auto Dragon Belt", "Tự động lấy Dragon Belt", function(state)
    toggles.AutoDragonBelt = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.AutoDragonBelt and LocalPlayer.Character do
                -- Dịch chuyển đến Hydra Island để farm Dragon Scales
                teleportTo(CFrame.new(5750, 610, -280))
                local scaleCount = 0
                while scaleCount < 10 and toggles.AutoDragonBelt do
                    if next(Workspace.Enemies:GetChildren()) then
                        for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                            if (enemy.Name == "Dragon Crew Warrior" or enemy.Name == "Dragon Crew Archer") and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                                teleportTo(enemy.HumanoidRootPart.CFrame)
                                wait(attackSpeed)
                                scaleCount = scaleCount + 1 -- Giả định mỗi lần giết được 1 Dragon Scale
                            end
                        end
                    end
                    wait(1)
                end
                -- Dịch chuyển đến Tiki Outpost để mua Dragon Belt
                teleportTo(CFrame.new(-16250, 100, 1000))
                ReplicatedStorage.Remotes.CommF_:InvokeServer("BuyItem", "Dragon Belt")
                wait(5)
            end
        end)
    end
end)

-- 7️⃣ Tab ESP
local ESPTab = Window:NewTab("ESP")
local ESPSection = ESPTab:NewSection("ESP Features")
ESPSection:NewToggle("ESP", "Hiển thị mục tiêu", function(state)
    toggles.ESP = state
    playClickSound()
    if state then
        spawn(function()
            while toggles.ESP and LocalPlayer.Character do
                for _, obj in pairs(Workspace:GetChildren()) do
                    if (obj:FindFirstChild("Humanoid") or obj.Name:match("Chest") or obj:IsA("Tool")) and not obj:FindFirstChild("BillboardGui") then
                        local esp = Instance.new("BillboardGui", obj)
                        esp.Size = UDim2.new(0, 100, 0, 50)
                        esp.StudsOffset = Vector3.new(0, 3, 0)
                        local text = Instance.new("TextLabel", esp)
                        text.Size = UDim2.new(1, 0, 1, 0)
                        text.Text = obj.Name
                        text.BackgroundTransparency = 1
                        text.TextColor3 = Color3.fromRGB(255, 0, 0)
                        table.insert(espInstances, esp)
                    end
                end
                wait(5)
            end
        end)
    else
        clearESP()
    end
end)

-- Thông báo khi chạy
Library:Notify("MoonCat Hub (Kavo UI - BlurEffect) đã chạy!", 5)
